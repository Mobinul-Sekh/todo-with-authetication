<%- include("header", {page: 'auth' }) -%>

  <form id="signinForm" class="text-certer container form-group" action="/signin-user" method="post">
    <div class="mb-3">
      <label for="inputEmail" class="form-label">Email address</label>
      <input type="email" id="inputEmail" name="email" placeholder="Enter Your Email">
    </div>
    <div class="mb-3">
      <label for="inputPassword">Password</label>
      <input type="password" class="form-control" name="password" id="inputPassword" placeholder="Enter Your Password">
    </div>
    <button type="submit" class="btn">SIGNIN</button>
  </form>

  <%- include("footer") -%>

  <script>
    // Function to handle form submission
    async function handleFormSubmission(event) {
      event.preventDefault(); // Prevent default form submission

      const formData = new FormData(event.target);
      const email = formData.get('email');
      const password = formData.get('password');

      try {
        const response = await fetch('/signin-user', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ email, password }),
        });

        if (!response.ok) {
          throw new Error('Signin failed');
        }

        // Extract the token from the response
        const data = await response.json();
        const token = data.token;
        console.log(token);
        
        
        fetch('/read-all', {
          method: 'GET',
          headers: {
            'Authorization': `Bearer ${token}`,
          },
        })
        .then((res) => {
          if(res){
            console.log("respone after get read-all with token => ", res);
            console.log(res.url);
            // window.location = '/read-all';
          }
        })
        
      } catch (error) {
        console.error(error);
      }
    }

    // Add an event listener to the form for form submission handling
    const signinForm = document.getElementById('signinForm');
    signinForm.addEventListener('submit', handleFormSubmission);

  </script>